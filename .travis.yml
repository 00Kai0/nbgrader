language: python
python:
  - 2.7
  - 3.4
sudo: false
branches:
  only:
    - master
env:
  matrix:
    - GROUP=docs
    - GROUP=js
    - GROUP=
  global:
    - secure: Ry2LhsYWOtVppoorTkOXyL6C6cEMw1bfqsHDka76kNSQzkn1HOpFOnVzjQk3kW3QxP9N60vcPlMtMln1jW1tsQRkh2mPT3EI0ugX18R5btR9R69CZSVo0At666HuQeZ6WN/a+pKWpaHYSFlXvSvlkLXkfW++AXbkShWvkD6Z0Hg=
before_install:
  - 'if [[ $GROUP == js* ]]; then npm install -g casperjs; fi'
  - cd ~ && git clone --quiet --depth 1 https://github.com/minrk/travis-wheels travis-wheels && cd -
  - cd ~ && git clone --recursive https://github.com/ipython/ipython.git && cd -
install:
  - cd ~/ipython && pip install -f ~/travis-wheels/wheelhouse file://$PWD#egg=ipython[all] && cd -
  - pip install -r requirements.txt
  - pip install nose coverage coveralls requests!=2.4.2 invoke
  - python setup.py install
  - if [[ $GROUP == 'js' ]]; then cp nbextensions/* $(ipython locate)/nbextensions/; fi
  - printf "print(\"COVERAGE_PROCESS_START={}\".format(os.environ.get('COVERAGE_PROCESS_START', '')))\n" > "/home/travis/virtualenv/python${TRAVIS_PYTHON_VERSION}/lib/python${TRAVIS_PYTHON_VERSION}/sitecustomize.py"
  - printf "import coverage\ncoverage.process_startup()\n" > "/home/travis/virtualenv/python${TRAVIS_PYTHON_VERSION}/lib/python${TRAVIS_PYTHON_VERSION}/sitecustomize.py"
script:
  - invoke tests --group="${GROUP}" --python-version="${TRAVIS_PYTHON_VERSION}" --pull-request="${TRAVIS_PULL_REQUEST}" --github-token="${GH_TOKEN}" --git-name="${GIT_NAME}" --git-email="${GIT_EMAIL}"
after_success:
  - invoke after_success --group="${GROUP}" --python-version="${TRAVIS_PYTHON_VERSION}"
